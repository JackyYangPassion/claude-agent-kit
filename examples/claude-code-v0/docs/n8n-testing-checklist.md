# n8n 工作流生成器测试清单

## 前置检查

### ✅ 环境准备
- [ ] n8n 已安装（`npm list -g n8n`）
- [ ] n8n 正在运行（访问 http://localhost:5678）
- [ ] 已获取 n8n API Key
- [ ] `.env` 文件配置正确
  - [ ] `ANTHROPIC_API_KEY` 已设置
  - [ ] `N8N_API_URL` 已设置
  - [ ] `N8N_API_KEY` 已设置
- [ ] 项目依赖已安装（`bun install`）
- [ ] 开发服务器能正常启动（`bun run dev`）

---

## 功能测试

### 1️⃣ 基础工作流创建

#### 测试用例 1.1: 简单定时任务
**输入**：
```
每分钟执行一次任务，记录当前时间
```

**预期结果**：
- [ ] AI 理解需求并开始创建工作流
- [ ] 显示工作流创建进度
- [ ] 工作流创建成功
- [ ] 显示工作流卡片，包含：
  - [ ] 工作流名称
  - [ ] 运行状态（运行中）
  - [ ] 触发器类型（Schedule Trigger）
  - [ ] 节点数量
  - [ ] 流程图
  - [ ] "在 n8n 中打开" 按钮
- [ ] 点击按钮能正确打开 n8n 工作流编辑页面
- [ ] 在 n8n 中能看到创建的工作流
- [ ] 工作流节点配置正确

#### 测试用例 1.2: HTTP 请求工作流
**输入**：
```
每5分钟从 https://jsonplaceholder.typicode.com/todos/1 获取数据
```

**预期结果**：
- [ ] 创建包含 Schedule Trigger 和 HTTP Request 节点的工作流
- [ ] HTTP Request 节点配置了正确的 URL
- [ ] 工作流能在 n8n 中成功执行
- [ ] 执行后能看到返回的 JSON 数据

---

### 2️⃣ 复杂工作流场景

#### 测试用例 2.1: 多步骤工作流
**输入**：
```
每小时获取 https://api.coindesk.com/v1/bpi/currentprice.json 的数据，提取 USD 价格，如果价格大于 50000 则记录到日志
```

**预期结果**：
- [ ] 创建包含 3+ 个节点的工作流
- [ ] 包含数据处理逻辑（提取字段）
- [ ] 包含条件判断（价格 > 50000）
- [ ] 节点连接正确
- [ ] 在 n8n 中执行能看到正确的数据流转

#### 测试用例 2.2: 数据转换工作流
**输入**：
```
获取 https://jsonplaceholder.typicode.com/users 的数据，提取前3个用户的 name 和 email，格式化后输出
```

**预期结果**：
- [ ] 工作流包含数据获取、处理、输出步骤
- [ ] 数据处理逻辑正确（提取字段、限制数量）
- [ ] 能在 n8n 中看到处理后的结果

---

### 3️⃣ 错误处理

#### 测试用例 3.1: 无效的 URL
**输入**：
```
每分钟从 https://invalid-domain-that-does-not-exist.com 获取数据
```

**预期结果**：
- [ ] 工作流创建成功
- [ ] 在 n8n 中执行时显示错误信息
- [ ] 错误信息清晰易懂

#### 测试用例 3.2: 模糊的描述
**输入**：
```
帮我做点什么
```

**预期结果**：
- [ ] AI 请求用户提供更具体的描述
- [ ] 或者提供一些建议和示例

---

### 4️⃣ UI/UX 测试

#### 测试用例 4.1: 工作流卡片展示
**检查项**：
- [ ] 工作流卡片样式美观
- [ ] 信息展示清晰完整
- [ ] 状态标识明确（运行中/已停止）
- [ ] 按钮响应正常
- [ ] 复制链接功能正常
- [ ] 时间格式化正确

#### 测试用例 4.2: 多个工作流管理
**操作**：
1. 创建 3 个不同的工作流
2. 观察界面展示

**检查项**：
- [ ] 所有工作流都正确展示
- [ ] 没有重复或遗漏
- [ ] 可以分别打开各个工作流
- [ ] 工作流顺序合理（按创建时间）

#### 测试用例 4.3: 实时更新
**操作**：
1. 创建一个工作流
2. 在 n8n 中修改工作流状态（激活/停用）

**检查项**：
- [ ] 前端能实时反映状态变化（如果实现了轮询或 WebSocket 同步）
- [ ] 或刷新后能看到最新状态

---

### 5️⃣ 会话管理

#### 测试用例 5.1: 会话持久化
**操作**：
1. 创建 2 个工作流
2. 刷新页面
3. 检查工作流是否仍然显示

**检查项**：
- [ ] 工作流列表保持不变
- [ ] 所有信息正确保留

#### 测试用例 5.2: 新会话
**操作**：
1. 创建一个工作流
2. 打开新的浏览器窗口/无痕模式
3. 访问应用

**检查项**：
- [ ] 新会话中看不到之前的工作流
- [ ] 可以创建新的独立工作流

---

### 6️⃣ 性能测试

#### 测试用例 6.1: 创建速度
**检查项**：
- [ ] 简单工作流创建时间 < 10 秒
- [ ] 复杂工作流创建时间 < 30 秒
- [ ] 过程中有加载指示器
- [ ] 不会阻塞 UI

#### 测试用例 6.2: 大量工作流
**操作**：
创建 10 个工作流

**检查项**：
- [ ] 界面仍然流畅
- [ ] 所有工作流都能正确展示
- [ ] 滚动性能良好

---

### 7️⃣ 兼容性测试

#### 测试用例 7.1: 浏览器兼容性
**测试浏览器**：
- [ ] Chrome/Edge (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (最新版本)

**检查项**：
- [ ] 所有功能正常
- [ ] 样式显示正确
- [ ] 没有控制台错误

#### 测试用例 7.2: 响应式设计
**测试设备**：
- [ ] 桌面 (1920x1080)
- [ ] 平板 (768x1024)
- [ ] 手机 (375x667)

**检查项**：
- [ ] 布局适配良好
- [ ] 按钮可点击
- [ ] 文字可读

---

## 集成测试

### 8️⃣ n8n 集成

#### 测试用例 8.1: API 连接
**操作**：
1. 停止 n8n
2. 尝试创建工作流

**预期结果**：
- [ ] 显示连接错误提示
- [ ] 错误信息友好且有指导意义

#### 测试用例 8.2: 无效 API Key
**操作**：
1. 修改 `.env` 中的 `N8N_API_KEY` 为无效值
2. 重启应用
3. 尝试创建工作流

**预期结果**：
- [ ] 显示认证错误
- [ ] 提示检查 API Key

---

## 安全性测试

### 9️⃣ 数据安全

#### 测试用例 9.1: 敏感信息
**检查项**：
- [ ] API Key 不会出现在前端代码中
- [ ] API Key 不会出现在网络请求响应中
- [ ] 浏览器控制台不会输出敏感信息

#### 测试用例 9.2: XSS 防护
**操作**：
输入包含脚本的工作流描述：
```
创建工作流 <script>alert('xss')</script>
```

**预期结果**：
- [ ] 脚本不会被执行
- [ ] 内容被正确转义或过滤

---

## 日志和调试

### 🔟 错误日志

#### 测试用例 10.1: 服务器日志
**检查项**：
- [ ] 创建工作流时有相关日志
- [ ] 错误时有详细的堆栈信息
- [ ] 日志级别合适（info, warn, error）

#### 测试用例 10.2: 浏览器控制台
**检查项**：
- [ ] 没有未捕获的错误
- [ ] 警告信息有意义
- [ ] 调试信息（如果启用）清晰

---

## 文档测试

### 1️⃣1️⃣ 文档完整性

**检查项**：
- [ ] 快速开始指南可用且准确
- [ ] 使用指南覆盖主要功能
- [ ] 设计文档描述了系统架构
- [ ] 代码注释充分
- [ ] README 中的示例可运行

---

## 测试总结

### 测试结果记录

| 测试类别 | 通过数 | 失败数 | 跳过数 | 备注 |
|---------|--------|--------|--------|------|
| 基础功能 |        |        |        |      |
| 复杂场景 |        |        |        |      |
| 错误处理 |        |        |        |      |
| UI/UX   |        |        |        |      |
| 会话管理 |        |        |        |      |
| 性能    |        |        |        |      |
| 兼容性  |        |        |        |      |
| 集成    |        |        |        |      |
| 安全性  |        |        |        |      |
| 日志    |        |        |        |      |
| 文档    |        |        |        |      |

### 已知问题

1. 
2. 
3. 

### 待改进项

1. 
2. 
3. 

---

## 快速测试脚本

```bash
#!/bin/bash
# 快速验证脚本

echo "🧪 开始测试 n8n 工作流生成器..."

# 1. 检查 n8n
echo "1️⃣ 检查 n8n 服务..."
curl -s http://localhost:5678 > /dev/null
if [ $? -eq 0 ]; then
    echo "✅ n8n 服务正常"
else
    echo "❌ n8n 服务未运行"
    exit 1
fi

# 2. 检查环境变量
echo "2️⃣ 检查环境变量..."
if [ -f .env ]; then
    if grep -q "N8N_API_KEY" .env; then
        echo "✅ .env 文件配置正常"
    else
        echo "❌ .env 缺少 N8N_API_KEY"
        exit 1
    fi
else
    echo "❌ 未找到 .env 文件"
    exit 1
fi

# 3. 检查依赖
echo "3️⃣ 检查项目依赖..."
if [ -d "node_modules" ]; then
    echo "✅ 依赖已安装"
else
    echo "⚠️  依赖未安装，运行 bun install"
    bun install
fi

# 4. 检查关键文件
echo "4️⃣ 检查关键文件..."
files=(
    "ccsdk/workflow-service.ts"
    "ccsdk/agent-prompt.ts"
    "client/components/workflow/workflow-card.tsx"
    "client/components/workflow/workflow-list.tsx"
    "shared/types/messages.ts"
)

for file in "${files[@]}"; do
    if [ -f "$file" ]; then
        echo "✅ $file"
    else
        echo "❌ 缺少 $file"
        exit 1
    fi
done

echo ""
echo "🎉 所有检查通过！可以开始测试了。"
echo ""
echo "运行以下命令启动服务："
echo "  bun run dev"
echo ""
echo "然后访问 http://localhost:3000 开始测试"
```

保存为 `test-setup.sh` 并运行：
```bash
chmod +x test-setup.sh
./test-setup.sh
```

